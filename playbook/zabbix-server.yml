---
- hosts: zabbix_server
  gather_facts: no
  tasks:
  - name: 'Install python3-pip'
    ansible.builtin.apt:
      name: python3-pip
  - name: 'pip zabbix-api'
    ansible.builtin.pip:
      name: zabbix-api

  - name: 'Create host groups'
    community.zabbix.zabbix_group:
      host_groups:
      - 'macOS hosts'
      - 'Other'
      # 既存のホストグループ:
      #- 'Linux servers'
      #- 'Virtual machines'
      #- 'Zabbix servers'
      state: present
      login_user: '{{ zabbix_login_user }}'
      login_password: '{{ zabbix_login_password }}'
      server_url: '{{ zabbix_server_url }}'

  - name: 'Allow out to zabbix-agent'
    community.general.ufw:
      rule: allow
      port: '10050'
      proto: 'tcp'
      direction: 'out'
      comment: 'zabbix-agent'

  # $ grep listen /etc/nginx/conf.d/zabbix.conf
  #        listen          [::]:8080;
  - name: 'Allow to zabbix-frontend'
    community.general.ufw:
      rule: allow
      port: '8080'
      proto: 'tcp'
      comment: 'zabbix-frontend'
